#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Protected branch
protected_branch='main'

# Get the branch being pushed to
while read local_ref local_sha remote_ref remote_sha
do
  # Extract branch name from remote_ref (e.g., refs/heads/main -> main)
  branch=$(echo "$remote_ref" | sed 's|refs/heads/||')
  
  # Check if pushing to main branch
  if [ "$branch" = "$protected_branch" ]; then
    echo ""
    echo "⚠️  WARNING: You are about to push to the $protected_branch branch!"
    echo ""
    echo "To confirm this push, please enter the security code:"
    read -r -p "Enter code: " code
    
    if [ "$code" != "2323" ]; then
      echo ""
      echo "❌ Invalid code. Push to $protected_branch branch has been blocked."
      echo ""
      exit 1
    fi
    
    echo ""
    echo "✅ Code verified. Proceeding with push to $protected_branch..."
    echo ""
  fi
done

exit 0

